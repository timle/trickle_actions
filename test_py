## testing running actions for trickle through pythion
##

import requests

## get data
## parse json
## set led color based on data

# https://trickle-f05bc.firebaseio.com/kid.json
# https://trickle-f05bc.firebaseio.com/kid/[field].json

url_1 = 'https://trickle-f05bc.firebaseio.com/kid.json'

#url_bal = 'https://trickle-f05bc.firebaseio.com/kid/balance.json'
#url_goal = 'https://trickle-f05bc.firebaseio.com/kid/balance.json'
#url_trickle_amnt = 'https://trickle-f05bc.firebaseio.com/kid/trickleAmount.json'

import requests

#response = requests.get(url_bal)
#data = response.json()

response = requests.get(url_1)
data = response.json()

# error catch here

# data['balance']
# data['goal']
# data['trickleAmount']

goal_percent_int = int((float(data['balance']) / data['goal'])*100)



import RPi.GPIO as GPIO
import time
GPIO.setmode(GPIO.BCM)
GPIO.setwarnings(False)
GPIO.setup(21,GPIO.OUT)
print "LED on"
GPIO.output(21,GPIO.HIGH)
time.sleep(1)
print "LED off"
GPIO.output(21,GPIO.LOW)

while True:
    response = requests.get(url_1)
    data = response.json()
    goal_percent_int = int((float(data['balance']) / data['goal']) * 100)

    GPIO.output(21,goal_percent_int)

    time.sleep(5)
